import 'style/index.css';
import * as React from 'react';
import { useMemo } from 'react';
import styled, { keyframes } from 'styled-components'
import Button from '@mui/joy/Button';
import Box from '@mui/joy/Box';
import B from '@mui/joy/Box';
import Chip from '@mui/joy/Chip';
import CssBaseline from '@mui/joy/CssBaseline';
import Stack from '@mui/joy/Stack';
import Typography from '@mui/joy/Typography';
import T from '@mui/joy/Typography';
import PopupExample from './PopupExample';
import ImageGrid, { LabeledImage } from './ImageGrid';
import SegmentedImage from './SegmentedImage';
import ExampleGrid from './ExampleGrid';
import theme from '../theme';
import { CssVarsProvider, extendTheme } from '@mui/joy/styles';
import { Sheet } from '@mui/joy';
import ImageForm, { LabelBox, KeyHints } from './ImageForm';
// import PDDL from './PDDL';

function App() {
  return <CssVarsProvider theme={theme}>â€¦</CssVarsProvider>;
}

/* ---------------------------------- Utils --------------------------------- */

const Hi = styled.span`
  background-color: #ffc803;
  display: inline-block;
`
const Co = styled.span`
  color: #ffc803;
  margin: 0 0.2em;
`
const Bo = ({ c='primary', children, ...p }) => <Typography variant="soft" color={c} fontWeight={700} noWrap {...p}>{children}</Typography>

const Big = ({ children, v='soft', c='primary' }) => (
  children && <Chip color={c} variant={v} sx={{ fontSize: '1.8em', mx: 1, px: 2 }}>
    {/* <Co>[</Co> */}
    <b>{children}</b>
    {/* <Co>]</Co> */}
  </Chip>
)

const imageProcess = (img, { baseUrl }) => ({...img, src: img.src || `${baseUrl||''}/${img.file_name.replace(/^\//, '')}`})


/* -------------------------------------------------------------------------- */
/*                       Task 1: Mask Quality Assessment                      */
/* -------------------------------------------------------------------------- */

const InstructionsTask1 = ({ baseUrl }) => {
  const HEADER_IMS = [
    // {
    //   file_name:"P03_112_39_3781.jpg",
    //   label: 'container', correct: true,
    //   polygons:[[[295,189],[294,191],[288,191],[286,193],[282,193],[280,195],[279,195],[277,196],[275,196],[271,200],[269,200],[260,210],[260,211],[256,215],[256,217],[254,219],[254,223],[252,225],[252,247],[254,249],[254,253],[256,255],[256,256],[258,258],[258,260],[260,262],[260,264],[262,266],[262,268],[264,270],[264,271],[265,273],[265,275],[267,277],[267,279],[269,281],[269,283],[271,285],[271,286],[275,290],[275,292],[279,296],[279,298],[280,298],[284,301],[284,303],[286,305],[288,305],[292,309],[294,309],[295,311],[297,311],[299,313],[305,313],[307,315],[316,315],[318,313],[322,313],[323,311],[327,311],[329,309],[331,309],[337,303],[338,303],[344,298],[344,296],[348,292],[348,290],[350,288],[350,286],[352,285],[352,279],[353,277],[353,264],[355,262],[357,264],[363,264],[363,262],[365,260],[365,258],[367,256],[367,255],[368,253],[368,247],[367,245],[367,243],[363,240],[363,238],[361,236],[359,236],[355,232],[355,230],[353,228],[353,223],[352,221],[352,217],[350,215],[350,213],[348,211],[348,210],[344,206],[344,204],[340,200],[338,200],[335,196],[333,196],[331,195],[329,195],[327,193],[325,193],[323,191],[320,191],[318,189]]]
    // },
    {
      file_name:"P35_109_194_41022.jpg",
      label: 'cloth', correct: true,
      polygons:[[[455,0],[455,3],[449,9],[449,11],[447,13],[447,15],[441,20],[441,22],[440,24],[440,26],[436,30],[436,31],[434,33],[434,35],[430,39],[430,41],[428,43],[428,45],[425,48],[425,50],[423,52],[423,54],[421,56],[421,58],[417,61],[417,63],[413,67],[413,69],[410,73],[410,75],[408,76],[408,78],[404,82],[404,93],[412,101],[413,101],[415,103],[417,103],[423,108],[425,108],[432,116],[432,120],[434,121],[434,123],[432,125],[432,127],[430,129],[430,133],[428,135],[428,136],[427,138],[427,140],[425,142],[425,153],[428,157],[428,159],[436,166],[436,168],[451,183],[455,183],[466,195],[466,196],[468,198],[468,200],[473,206],[473,208],[483,208],[485,206],[485,200],[486,198],[486,195],[488,193],[488,191],[490,189],[490,187],[492,185],[492,181],[494,180],[494,178],[496,176],[496,172],[498,170],[498,168],[500,166],[500,165],[501,163],[501,157],[503,155],[503,153],[505,151],[505,150],[507,148],[507,144],[509,142],[509,140],[511,138],[511,135],[513,133],[513,99],[515,97],[515,93],[518,90],[520,90],[524,86],[524,84],[526,82],[528,82],[530,80],[530,78],[535,73],[537,73],[541,69],[550,69],[552,71],[552,82],[554,84],[554,103],[552,105],[552,110],[550,112],[550,116],[548,118],[548,120],[546,121],[546,125],[544,127],[544,133],[543,135],[543,138],[541,140],[541,146],[539,148],[539,153],[537,155],[537,161],[535,163],[535,165],[533,166],[533,170],[531,172],[531,180],[530,181],[530,191],[531,193],[533,193],[535,195],[537,195],[539,196],[556,196],[558,195],[563,195],[565,193],[569,193],[571,191],[574,191],[576,189],[580,189],[588,181],[588,180],[589,178],[589,174],[591,172],[591,170],[595,166],[595,163],[597,161],[597,157],[599,155],[599,151],[601,150],[601,146],[603,144],[603,138],[604,136],[604,129],[606,127],[606,121],[608,120],[608,116],[610,114],[610,110],[612,108],[612,105],[614,103],[614,91],[616,90],[616,78],[614,76],[614,75],[612,73],[612,71],[608,67],[608,65],[604,61],[604,60],[599,54],[599,52],[588,41],[588,39],[576,28],[576,26],[569,18],[569,16],[565,13],[565,11],[558,3],[558,0]]]
    },
    {
      file_name:"P30_107_792_126899.jpg",
      label: 'chopping board', correct: false,
      polygons:[[[346,316],[344,318],[348,318],[352,322],[352,324],[353,326],[357,326],[359,328],[363,328],[365,330],[368,330],[370,331],[372,331],[374,333],[376,333],[378,335],[382,335],[385,339],[393,339],[391,337],[391,333],[389,333],[387,331],[383,331],[378,326],[376,326],[374,324],[368,324],[367,322],[361,322],[359,320],[357,320],[355,318],[350,318],[348,316]],[[473,285],[470,288],[470,290],[468,292],[468,294],[466,296],[466,300],[464,301],[464,305],[462,307],[462,320],[460,322],[460,324],[455,330],[453,330],[451,331],[447,331],[436,343],[436,345],[434,346],[432,346],[428,350],[425,350],[421,354],[421,356],[423,358],[425,358],[427,360],[427,361],[428,361],[430,363],[434,363],[436,365],[440,365],[441,367],[443,367],[445,369],[447,369],[449,371],[453,371],[455,373],[458,373],[460,375],[468,375],[470,376],[471,376],[473,378],[481,378],[483,380],[496,380],[498,382],[501,382],[503,384],[507,384],[509,386],[528,386],[526,384],[522,384],[520,382],[518,382],[513,376],[509,376],[505,373],[503,373],[500,369],[498,369],[496,367],[494,367],[492,365],[492,363],[488,360],[486,360],[483,356],[483,354],[477,348],[477,343],[475,341],[475,313],[477,311],[477,305],[479,303],[479,288],[477,286],[477,285]],[[496,225],[496,226],[494,228],[494,230],[492,232],[492,234],[490,236],[490,238],[488,240],[488,243],[486,245],[486,258],[488,260],[490,258],[490,255],[492,253],[492,249],[494,247],[494,245],[496,243],[496,241],[498,240],[498,230],[500,228],[500,226],[498,225]],[[43,195],[33,204],[31,204],[29,202],[28,202],[26,200],[22,204],[22,206],[18,210],[9,210],[7,208],[5,208],[3,206],[3,204],[3,208],[1,210],[1,230],[3,232],[3,241],[7,241],[9,243],[11,243],[13,245],[14,245],[16,247],[16,249],[18,249],[20,251],[22,251],[24,253],[26,253],[28,255],[31,255],[33,256],[35,256],[37,258],[43,258],[44,260],[61,260],[63,262],[67,262],[69,264],[88,264],[89,266],[95,266],[97,264],[101,264],[103,262],[106,262],[110,258],[110,256],[112,255],[114,255],[116,253],[131,253],[132,255],[134,255],[136,256],[134,258],[134,260],[140,260],[138,258],[138,253],[140,251],[140,245],[142,243],[140,241],[140,240],[138,238],[138,234],[136,232],[136,230],[129,230],[127,228],[123,228],[121,226],[121,223],[114,223],[112,221],[110,221],[108,219],[106,219],[104,217],[103,217],[101,215],[99,215],[97,213],[93,213],[91,211],[88,211],[86,210],[86,208],[84,206],[73,206],[69,202],[69,198],[67,196],[65,196],[63,195]],[[294,0],[294,3],[292,5],[292,7],[290,9],[290,11],[286,15],[286,16],[284,18],[284,20],[282,22],[282,24],[280,26],[280,28],[279,30],[279,31],[277,33],[277,35],[275,37],[275,39],[273,41],[273,43],[271,45],[271,46],[269,48],[269,50],[265,54],[265,56],[262,60],[262,63],[260,65],[260,67],[258,69],[258,71],[256,73],[256,75],[254,76],[254,80],[252,82],[252,84],[250,86],[250,88],[249,90],[249,91],[247,93],[247,95],[245,97],[245,99],[243,101],[243,103],[241,105],[241,106],[239,108],[239,112],[235,116],[235,118],[234,120],[234,121],[232,123],[232,125],[230,127],[230,129],[228,131],[228,133],[226,135],[226,136],[224,138],[224,142],[220,146],[220,148],[219,150],[219,151],[217,153],[217,155],[215,157],[215,159],[213,161],[213,163],[211,165],[211,166],[209,168],[209,172],[206,176],[206,178],[204,180],[204,181],[202,183],[202,185],[200,187],[200,189],[198,191],[198,193],[196,195],[196,196],[194,198],[194,200],[191,204],[191,206],[189,208],[189,210],[187,211],[187,215],[185,217],[185,219],[183,221],[183,223],[181,225],[181,228],[179,230],[179,236],[177,238],[177,249],[179,251],[179,256],[181,258],[181,264],[185,268],[189,268],[191,270],[206,270],[207,268],[207,266],[213,260],[219,260],[220,258],[222,258],[224,256],[226,256],[228,255],[230,255],[235,249],[235,247],[237,245],[237,243],[243,238],[243,234],[245,232],[245,225],[247,223],[247,217],[249,215],[249,211],[250,210],[250,208],[252,206],[252,202],[254,200],[254,196],[258,193],[258,189],[260,187],[260,183],[262,181],[262,180],[264,178],[264,176],[265,174],[265,168],[267,166],[267,159],[269,157],[269,155],[273,151],[273,148],[275,146],[275,144],[277,142],[277,138],[280,135],[280,133],[282,131],[282,129],[284,127],[284,125],[288,121],[288,120],[290,118],[290,114],[294,110],[294,108],[295,106],[295,105],[297,103],[297,99],[299,97],[299,95],[301,93],[301,91],[303,90],[303,86],[305,84],[305,78],[307,76],[307,75],[309,73],[309,71],[310,69],[310,67],[312,65],[312,63],[314,61],[314,60],[318,56],[318,54],[320,52],[320,50],[323,46],[323,45],[325,43],[325,37],[327,35],[327,28],[329,26],[329,9],[331,7],[331,0]]]
    },
  ]
  const EXAMPLES = [
    {
      title: 'Easy Cases',
      description: 'The object is clearly visible and easy to classify.',
      images: [
        // {
        //   file_name:"P03_112_39_3781.jpg",
        //   label: 'container', correct: true,
        //   polygons:[[[295,189],[294,191],[288,191],[286,193],[282,193],[280,195],[279,195],[277,196],[275,196],[271,200],[269,200],[260,210],[260,211],[256,215],[256,217],[254,219],[254,223],[252,225],[252,247],[254,249],[254,253],[256,255],[256,256],[258,258],[258,260],[260,262],[260,264],[262,266],[262,268],[264,270],[264,271],[265,273],[265,275],[267,277],[267,279],[269,281],[269,283],[271,285],[271,286],[275,290],[275,292],[279,296],[279,298],[280,298],[284,301],[284,303],[286,305],[288,305],[292,309],[294,309],[295,311],[297,311],[299,313],[305,313],[307,315],[316,315],[318,313],[322,313],[323,311],[327,311],[329,309],[331,309],[337,303],[338,303],[344,298],[344,296],[348,292],[348,290],[350,288],[350,286],[352,285],[352,279],[353,277],[353,264],[355,262],[357,264],[363,264],[363,262],[365,260],[365,258],[367,256],[367,255],[368,253],[368,247],[367,245],[367,243],[363,240],[363,238],[361,236],[359,236],[355,232],[355,230],[353,228],[353,223],[352,221],[352,217],[350,215],[350,213],[348,211],[348,210],[344,206],[344,204],[340,200],[338,200],[335,196],[333,196],[331,195],[329,195],[327,193],[325,193],[323,191],[320,191],[318,189]]]
        // },
        {
          file_name:"P35_109_194_41022.jpg",
          label: 'cloth', correct: true,
          polygons:[[[455,0],[455,3],[449,9],[449,11],[447,13],[447,15],[441,20],[441,22],[440,24],[440,26],[436,30],[436,31],[434,33],[434,35],[430,39],[430,41],[428,43],[428,45],[425,48],[425,50],[423,52],[423,54],[421,56],[421,58],[417,61],[417,63],[413,67],[413,69],[410,73],[410,75],[408,76],[408,78],[404,82],[404,93],[412,101],[413,101],[415,103],[417,103],[423,108],[425,108],[432,116],[432,120],[434,121],[434,123],[432,125],[432,127],[430,129],[430,133],[428,135],[428,136],[427,138],[427,140],[425,142],[425,153],[428,157],[428,159],[436,166],[436,168],[451,183],[455,183],[466,195],[466,196],[468,198],[468,200],[473,206],[473,208],[483,208],[485,206],[485,200],[486,198],[486,195],[488,193],[488,191],[490,189],[490,187],[492,185],[492,181],[494,180],[494,178],[496,176],[496,172],[498,170],[498,168],[500,166],[500,165],[501,163],[501,157],[503,155],[503,153],[505,151],[505,150],[507,148],[507,144],[509,142],[509,140],[511,138],[511,135],[513,133],[513,99],[515,97],[515,93],[518,90],[520,90],[524,86],[524,84],[526,82],[528,82],[530,80],[530,78],[535,73],[537,73],[541,69],[550,69],[552,71],[552,82],[554,84],[554,103],[552,105],[552,110],[550,112],[550,116],[548,118],[548,120],[546,121],[546,125],[544,127],[544,133],[543,135],[543,138],[541,140],[541,146],[539,148],[539,153],[537,155],[537,161],[535,163],[535,165],[533,166],[533,170],[531,172],[531,180],[530,181],[530,191],[531,193],[533,193],[535,195],[537,195],[539,196],[556,196],[558,195],[563,195],[565,193],[569,193],[571,191],[574,191],[576,189],[580,189],[588,181],[588,180],[589,178],[589,174],[591,172],[591,170],[595,166],[595,163],[597,161],[597,157],[599,155],[599,151],[601,150],[601,146],[603,144],[603,138],[604,136],[604,129],[606,127],[606,121],[608,120],[608,116],[610,114],[610,110],[612,108],[612,105],[614,103],[614,91],[616,90],[616,78],[614,76],[614,75],[612,73],[612,71],[608,67],[608,65],[604,61],[604,60],[599,54],[599,52],[588,41],[588,39],[576,28],[576,26],[569,18],[569,16],[565,13],[565,11],[558,3],[558,0]]]
        },
        {
          file_name:"P07_110_11_1608.jpg",
          label: 'banana', correct: true,
          polygons:[[[370,193],[368,195],[367,195],[365,196],[363,196],[363,204],[359,208],[359,226],[365,232],[365,236],[361,240],[361,241],[359,243],[359,260],[361,262],[361,264],[363,266],[363,268],[365,270],[365,271],[368,275],[370,275],[374,279],[374,281],[376,281],[387,292],[389,292],[391,294],[397,294],[398,296],[400,296],[402,298],[404,298],[406,300],[408,300],[410,301],[413,301],[415,303],[423,303],[425,305],[428,305],[430,303],[441,303],[440,301],[438,301],[436,300],[427,300],[425,298],[423,298],[421,296],[419,296],[415,292],[415,288],[419,285],[421,285],[423,283],[423,279],[425,277],[425,275],[423,273],[423,271],[421,270],[421,266],[419,264],[419,260],[417,258],[417,253],[415,251],[415,245],[413,243],[413,241],[410,238],[410,236],[400,226],[400,223],[398,223],[397,221],[397,219],[391,213],[391,211],[389,210],[389,208],[387,206],[387,204],[382,198],[380,198],[376,195],[374,195],[372,193]]]
        },
        {
          file_name:"P30_107_792_126899.jpg",
          label: 'chopping board', correct: false,
          polygons:[[[346,316],[344,318],[348,318],[352,322],[352,324],[353,326],[357,326],[359,328],[363,328],[365,330],[368,330],[370,331],[372,331],[374,333],[376,333],[378,335],[382,335],[385,339],[393,339],[391,337],[391,333],[389,333],[387,331],[383,331],[378,326],[376,326],[374,324],[368,324],[367,322],[361,322],[359,320],[357,320],[355,318],[350,318],[348,316]],[[473,285],[470,288],[470,290],[468,292],[468,294],[466,296],[466,300],[464,301],[464,305],[462,307],[462,320],[460,322],[460,324],[455,330],[453,330],[451,331],[447,331],[436,343],[436,345],[434,346],[432,346],[428,350],[425,350],[421,354],[421,356],[423,358],[425,358],[427,360],[427,361],[428,361],[430,363],[434,363],[436,365],[440,365],[441,367],[443,367],[445,369],[447,369],[449,371],[453,371],[455,373],[458,373],[460,375],[468,375],[470,376],[471,376],[473,378],[481,378],[483,380],[496,380],[498,382],[501,382],[503,384],[507,384],[509,386],[528,386],[526,384],[522,384],[520,382],[518,382],[513,376],[509,376],[505,373],[503,373],[500,369],[498,369],[496,367],[494,367],[492,365],[492,363],[488,360],[486,360],[483,356],[483,354],[477,348],[477,343],[475,341],[475,313],[477,311],[477,305],[479,303],[479,288],[477,286],[477,285]],[[496,225],[496,226],[494,228],[494,230],[492,232],[492,234],[490,236],[490,238],[488,240],[488,243],[486,245],[486,258],[488,260],[490,258],[490,255],[492,253],[492,249],[494,247],[494,245],[496,243],[496,241],[498,240],[498,230],[500,228],[500,226],[498,225]],[[43,195],[33,204],[31,204],[29,202],[28,202],[26,200],[22,204],[22,206],[18,210],[9,210],[7,208],[5,208],[3,206],[3,204],[3,208],[1,210],[1,230],[3,232],[3,241],[7,241],[9,243],[11,243],[13,245],[14,245],[16,247],[16,249],[18,249],[20,251],[22,251],[24,253],[26,253],[28,255],[31,255],[33,256],[35,256],[37,258],[43,258],[44,260],[61,260],[63,262],[67,262],[69,264],[88,264],[89,266],[95,266],[97,264],[101,264],[103,262],[106,262],[110,258],[110,256],[112,255],[114,255],[116,253],[131,253],[132,255],[134,255],[136,256],[134,258],[134,260],[140,260],[138,258],[138,253],[140,251],[140,245],[142,243],[140,241],[140,240],[138,238],[138,234],[136,232],[136,230],[129,230],[127,228],[123,228],[121,226],[121,223],[114,223],[112,221],[110,221],[108,219],[106,219],[104,217],[103,217],[101,215],[99,215],[97,213],[93,213],[91,211],[88,211],[86,210],[86,208],[84,206],[73,206],[69,202],[69,198],[67,196],[65,196],[63,195]],[[294,0],[294,3],[292,5],[292,7],[290,9],[290,11],[286,15],[286,16],[284,18],[284,20],[282,22],[282,24],[280,26],[280,28],[279,30],[279,31],[277,33],[277,35],[275,37],[275,39],[273,41],[273,43],[271,45],[271,46],[269,48],[269,50],[265,54],[265,56],[262,60],[262,63],[260,65],[260,67],[258,69],[258,71],[256,73],[256,75],[254,76],[254,80],[252,82],[252,84],[250,86],[250,88],[249,90],[249,91],[247,93],[247,95],[245,97],[245,99],[243,101],[243,103],[241,105],[241,106],[239,108],[239,112],[235,116],[235,118],[234,120],[234,121],[232,123],[232,125],[230,127],[230,129],[228,131],[228,133],[226,135],[226,136],[224,138],[224,142],[220,146],[220,148],[219,150],[219,151],[217,153],[217,155],[215,157],[215,159],[213,161],[213,163],[211,165],[211,166],[209,168],[209,172],[206,176],[206,178],[204,180],[204,181],[202,183],[202,185],[200,187],[200,189],[198,191],[198,193],[196,195],[196,196],[194,198],[194,200],[191,204],[191,206],[189,208],[189,210],[187,211],[187,215],[185,217],[185,219],[183,221],[183,223],[181,225],[181,228],[179,230],[179,236],[177,238],[177,249],[179,251],[179,256],[181,258],[181,264],[185,268],[189,268],[191,270],[206,270],[207,268],[207,266],[213,260],[219,260],[220,258],[222,258],[224,256],[226,256],[228,255],[230,255],[235,249],[235,247],[237,245],[237,243],[243,238],[243,234],[245,232],[245,225],[247,223],[247,217],[249,215],[249,211],[250,210],[250,208],[252,206],[252,202],[254,200],[254,196],[258,193],[258,189],[260,187],[260,183],[262,181],[262,180],[264,178],[264,176],[265,174],[265,168],[267,166],[267,159],[269,157],[269,155],[273,151],[273,148],[275,146],[275,144],[277,142],[277,138],[280,135],[280,133],[282,131],[282,129],[284,127],[284,125],[288,121],[288,120],[290,118],[290,114],[294,110],[294,108],[295,106],[295,105],[297,103],[297,99],[299,97],[299,95],[301,93],[301,91],[303,90],[303,86],[305,84],[305,78],[307,76],[307,75],[309,73],[309,71],[310,69],[310,67],[312,65],[312,63],[314,61],[314,60],[318,56],[318,54],[320,52],[320,50],[323,46],[323,45],[325,43],[325,37],[327,35],[327,28],[329,26],[329,9],[331,7],[331,0]]]
        },
      ],
    },
    {
      title: 'Not JUST the object',
      description: 'In some cases, you can allow additional objects in the segmentation, provided that the target object is still the primary object highlighted.',
      images: [
        {
          file_name:"P28_04_56_18429.jpg",
          label: 'carrot', correct: true,
          polygons:[
            // [[505,335],[505,337],[507,339],[507,348],[505,350],[486,350],[485,352],[475,352],[473,350],[471,350],[470,348],[470,350],[471,352],[471,356],[473,358],[473,361],[475,363],[475,365],[477,367],[477,369],[479,371],[479,375],[481,376],[481,380],[483,382],[483,384],[485,386],[485,388],[486,390],[486,391],[488,393],[488,397],[490,399],[490,401],[494,405],[494,406],[496,408],[496,410],[500,414],[500,416],[501,418],[501,420],[503,421],[503,423],[507,427],[507,429],[509,431],[509,435],[511,436],[511,438],[513,440],[513,442],[515,444],[515,446],[516,448],[518,448],[518,446],[522,442],[530,442],[531,444],[533,444],[535,446],[537,446],[539,444],[539,442],[543,438],[543,423],[541,421],[541,418],[539,416],[539,412],[537,410],[537,406],[535,405],[535,403],[533,401],[533,399],[531,397],[531,393],[530,391],[530,390],[526,386],[526,384],[524,382],[524,380],[522,378],[522,376],[518,373],[518,371],[516,369],[516,367],[515,365],[515,363],[513,361],[513,356],[511,354],[511,343],[509,341],[509,339]],
            // [[647,249],[646,251],[642,251],[640,253],[638,253],[636,255],[634,255],[633,256],[629,256],[627,258],[625,258],[623,260],[621,260],[618,264],[616,264],[616,266],[608,273],[608,286],[610,288],[610,292],[612,294],[612,296],[614,298],[614,300],[616,301],[616,303],[618,305],[618,307],[623,313],[625,313],[627,315],[631,315],[633,316],[636,316],[638,318],[642,318],[644,316],[646,316],[647,315],[649,315],[651,313],[657,313],[659,311],[664,311],[666,309],[668,309],[670,307],[672,307],[674,305],[677,305],[683,300],[683,298],[685,296],[685,275],[677,268],[677,266],[676,264],[676,262],[672,258],[672,256],[670,256],[666,253],[664,253],[661,249]],
            [[531,228],[528,232],[528,236],[530,238],[533,238],[550,255],[552,255],[554,256],[554,262],[544,271],[544,275],[552,283],[552,285],[554,285],[558,288],[558,290],[559,292],[559,294],[567,301],[567,303],[573,309],[573,311],[576,315],[576,316],[580,320],[580,322],[584,326],[584,328],[588,331],[588,333],[589,335],[589,337],[591,339],[591,341],[597,346],[597,348],[599,350],[599,352],[604,358],[610,358],[612,356],[614,356],[621,348],[623,348],[625,346],[625,345],[627,343],[627,339],[618,330],[618,328],[610,320],[608,320],[606,318],[606,316],[597,307],[597,305],[591,300],[591,298],[588,294],[588,292],[586,292],[584,290],[584,288],[582,286],[582,285],[578,281],[578,279],[576,277],[576,275],[574,273],[574,271],[567,264],[567,262],[565,260],[565,258],[563,256],[561,256],[558,253],[558,251],[548,241],[546,241],[541,236],[541,234],[539,234],[535,230],[535,228]],
            [[546,210],[546,217],[548,219],[548,221],[554,226],[554,228],[559,234],[559,236],[571,247],[571,249],[573,251],[574,251],[578,255],[578,258],[580,258],[580,251],[578,249],[576,249],[574,247],[574,243],[573,241],[573,240],[571,240],[569,238],[569,236],[567,234],[567,232],[565,230],[565,228],[559,223],[559,221],[558,219],[558,217],[550,210]]
          ]
        },
        {
          file_name:"P28_04_56_18429.jpg",
          label: 'carrot', correct: false,
          polygons: [
            [[505,335],[505,337],[507,339],[507,348],[505,350],[486,350],[485,352],[475,352],[473,350],[471,350],[470,348],[470,350],[471,352],[471,356],[473,358],[473,361],[475,363],[475,365],[477,367],[477,369],[479,371],[479,375],[481,376],[481,380],[483,382],[483,384],[485,386],[485,388],[486,390],[486,391],[488,393],[488,397],[490,399],[490,401],[494,405],[494,406],[496,408],[496,410],[500,414],[500,416],[501,418],[501,420],[503,421],[503,423],[507,427],[507,429],[509,431],[509,435],[511,436],[511,438],[513,440],[513,442],[515,444],[515,446],[516,448],[518,448],[518,446],[522,442],[530,442],[531,444],[533,444],[535,446],[537,446],[539,444],[539,442],[543,438],[543,423],[541,421],[541,418],[539,416],[539,412],[537,410],[537,406],[535,405],[535,403],[533,401],[533,399],[531,397],[531,393],[530,391],[530,390],[526,386],[526,384],[524,382],[524,380],[522,378],[522,376],[518,373],[518,371],[516,369],[516,367],[515,365],[515,363],[513,361],[513,356],[511,354],[511,343],[509,341],[509,339]],
            [[647,249],[646,251],[642,251],[640,253],[638,253],[636,255],[634,255],[633,256],[629,256],[627,258],[625,258],[623,260],[621,260],[618,264],[616,264],[616,266],[608,273],[608,286],[610,288],[610,292],[612,294],[612,296],[614,298],[614,300],[616,301],[616,303],[618,305],[618,307],[623,313],[625,313],[627,315],[631,315],[633,316],[636,316],[638,318],[642,318],[644,316],[646,316],[647,315],[649,315],[651,313],[657,313],[659,311],[664,311],[666,309],[668,309],[670,307],[672,307],[674,305],[677,305],[683,300],[683,298],[685,296],[685,275],[677,268],[677,266],[676,264],[676,262],[672,258],[672,256],[670,256],[666,253],[664,253],[661,249]],
            [[531,228],[528,232],[528,236],[530,238],[533,238],[550,255],[552,255],[554,256],[554,262],[544,271],[544,275],[552,283],[552,285],[554,285],[558,288],[558,290],[559,292],[559,294],[567,301],[567,303],[573,309],[573,311],[576,315],[576,316],[580,320],[580,322],[584,326],[584,328],[588,331],[588,333],[589,335],[589,337],[591,339],[591,341],[597,346],[597,348],[599,350],[599,352],[604,358],[610,358],[612,356],[614,356],[621,348],[623,348],[625,346],[625,345],[627,343],[627,339],[618,330],[618,328],[610,320],[608,320],[606,318],[606,316],[597,307],[597,305],[591,300],[591,298],[588,294],[588,292],[586,292],[584,290],[584,288],[582,286],[582,285],[578,281],[578,279],[576,277],[576,275],[574,273],[574,271],[567,264],[567,262],[565,260],[565,258],[563,256],[561,256],[558,253],[558,251],[548,241],[546,241],[541,236],[541,234],[539,234],[535,230],[535,228]],
            [[546,210],[546,217],[548,219],[548,221],[554,226],[554,228],[559,234],[559,236],[571,247],[571,249],[573,251],[574,251],[578,255],[578,258],[580,258],[580,251],[578,249],[576,249],[574,247],[574,243],[573,241],[573,240],[571,240],[569,238],[569,236],[567,234],[567,232],[565,230],[565,228],[559,223],[559,221],[558,219],[558,217],[550,210]]
          ]
        },
        {
          file_name:"P11_13_20_3134.jpg",
          label: 'cereal', correct: false,
          polygons:[
            [[361,431],[359,433],[348,433],[346,435],[342,435],[340,436],[340,444],[338,446],[338,457],[337,459],[337,465],[335,466],[335,468],[333,470],[333,472],[331,474],[331,478],[516,478],[496,478],[494,476],[494,474],[492,472],[490,472],[485,466],[479,466],[477,465],[475,465],[473,463],[471,463],[470,461],[466,461],[464,459],[460,459],[458,457],[455,457],[453,455],[451,455],[449,453],[445,453],[443,451],[436,451],[432,448],[428,448],[427,446],[423,446],[421,444],[415,444],[413,442],[408,442],[406,440],[402,440],[400,438],[395,438],[393,436],[387,436],[385,435],[380,435],[378,433],[370,433],[368,431]],[[492,241],[490,243],[488,243],[488,247],[486,249],[486,256],[488,258],[488,285],[486,286],[486,292],[485,294],[485,313],[486,315],[486,333],[483,337],[483,339],[481,341],[481,343],[477,346],[477,348],[475,350],[473,350],[468,356],[464,356],[462,358],[455,358],[451,354],[451,352],[453,350],[453,345],[455,343],[455,335],[456,333],[456,330],[458,328],[458,322],[460,320],[460,315],[462,313],[462,309],[464,307],[464,300],[466,298],[466,294],[464,292],[464,290],[462,288],[460,288],[458,286],[456,286],[455,285],[453,285],[451,283],[449,283],[447,281],[447,279],[441,273],[441,271],[440,270],[440,268],[438,266],[438,264],[434,260],[434,258],[432,258],[430,256],[423,256],[421,258],[419,258],[413,264],[412,264],[412,266],[410,268],[410,281],[412,283],[412,286],[413,288],[413,290],[415,292],[415,294],[421,300],[421,301],[423,303],[421,305],[421,311],[415,316],[413,316],[412,318],[410,318],[408,320],[406,320],[402,324],[400,324],[398,326],[398,328],[397,330],[397,331],[393,335],[393,337],[391,339],[391,341],[389,343],[389,345],[383,350],[383,352],[374,361],[374,363],[370,367],[368,367],[367,369],[365,369],[357,376],[357,378],[359,380],[367,380],[368,382],[374,382],[376,384],[383,384],[387,388],[402,388],[404,390],[410,390],[412,391],[428,391],[430,393],[471,393],[473,395],[516,395],[518,397],[531,397],[533,399],[546,399],[550,403],[563,403],[565,405],[573,405],[574,406],[580,406],[582,408],[588,408],[588,403],[586,401],[586,397],[584,395],[584,390],[582,388],[582,384],[580,382],[580,380],[576,376],[576,375],[573,371],[573,369],[569,365],[569,363],[561,356],[561,354],[556,348],[556,346],[552,343],[552,341],[543,331],[541,331],[539,330],[539,328],[537,326],[537,324],[533,320],[533,318],[528,313],[528,311],[526,309],[526,307],[524,305],[524,301],[522,300],[522,298],[520,296],[520,285],[522,283],[522,258],[520,256],[520,255],[509,243],[507,243],[505,241]],[[333,174],[329,178],[327,178],[325,180],[323,180],[322,181],[320,181],[316,185],[312,185],[310,187],[271,187],[269,189],[265,189],[264,187],[260,187],[258,189],[249,189],[247,187],[232,187],[230,185],[220,185],[219,183],[213,183],[211,181],[196,181],[192,185],[191,185],[187,189],[185,189],[176,198],[174,198],[161,211],[159,211],[159,213],[153,219],[151,219],[151,221],[146,226],[144,226],[144,228],[138,234],[136,234],[131,240],[129,240],[127,241],[125,241],[123,243],[121,243],[117,247],[117,249],[108,258],[108,260],[104,264],[104,266],[101,270],[101,271],[99,273],[101,275],[101,281],[103,283],[103,286],[104,288],[104,315],[103,316],[103,322],[101,324],[101,326],[99,328],[99,330],[97,331],[97,333],[95,335],[95,339],[91,343],[91,346],[89,348],[89,350],[88,352],[88,356],[86,358],[86,360],[84,361],[84,367],[82,369],[82,373],[80,375],[80,378],[76,382],[76,386],[74,388],[74,390],[73,391],[73,393],[71,395],[71,399],[69,401],[69,405],[67,406],[67,418],[65,420],[65,421],[67,423],[67,429],[69,431],[69,433],[71,435],[71,436],[73,438],[73,440],[80,448],[80,450],[82,451],[84,451],[86,453],[89,453],[91,455],[97,455],[99,457],[106,457],[108,455],[114,455],[116,453],[117,453],[119,451],[121,451],[123,450],[125,450],[127,448],[131,448],[134,444],[136,444],[138,442],[140,442],[144,438],[146,438],[147,436],[151,436],[153,435],[155,435],[192,397],[194,397],[194,395],[198,391],[200,391],[206,386],[207,386],[213,380],[215,380],[220,375],[222,375],[224,373],[226,373],[230,369],[232,369],[245,356],[247,356],[249,354],[249,352],[252,348],[252,346],[258,341],[258,339],[260,337],[260,335],[265,330],[267,330],[269,328],[277,328],[279,326],[279,324],[284,318],[286,318],[288,316],[288,315],[292,311],[294,311],[295,309],[295,307],[327,275],[327,270],[329,268],[329,264],[342,251],[342,249],[344,247],[344,243],[346,241],[346,238],[348,236],[348,234],[350,232],[350,226],[352,225],[352,219],[353,217],[353,215],[355,213],[355,211],[357,210],[357,208],[359,206],[359,195],[361,193],[361,189],[357,185],[357,183],[352,178],[350,178],[348,176],[344,176],[342,174]]
          ]
        },
      ],
    },
    {
      title: 'Partial object',
      description: 'Only part of the object is segmented. The first two contain meaningful parts of the object. The last one does not.',
      images: [
        // {
        //   file_name: "P30_109_112_9671.jpg",
        //   label: 'box', correct: true,
        //   polygons: [
        //     [[601,450],[601,453],[599,455],[599,461],[597,463],[597,465],[595,466],[595,470],[593,472],[593,478],[608,478],[608,463],[606,461],[606,453],[603,450]],
        //     [[432,294],[430,296],[421,296],[417,300],[415,300],[413,301],[412,301],[408,305],[404,305],[402,307],[400,307],[397,311],[397,313],[391,318],[391,320],[387,324],[387,326],[383,330],[383,331],[382,333],[382,335],[380,337],[380,339],[376,343],[376,346],[374,348],[374,350],[372,352],[372,356],[368,360],[368,361],[367,363],[367,365],[363,369],[363,371],[361,373],[361,375],[357,378],[357,380],[353,384],[353,386],[350,390],[348,390],[342,395],[340,395],[338,397],[337,397],[335,399],[323,399],[320,395],[320,393],[318,391],[318,390],[316,388],[316,386],[314,384],[314,382],[312,380],[312,376],[310,375],[310,373],[309,371],[301,371],[295,376],[294,376],[284,386],[284,401],[286,403],[286,410],[288,412],[288,418],[290,420],[290,421],[292,423],[292,427],[294,429],[294,433],[295,435],[295,440],[297,442],[297,446],[299,448],[299,450],[303,453],[303,455],[307,455],[310,459],[316,459],[318,461],[344,461],[346,463],[353,463],[359,468],[359,470],[361,472],[361,474],[363,476],[363,478],[397,478],[397,476],[395,474],[391,474],[389,472],[383,472],[382,470],[380,470],[378,468],[376,468],[353,446],[353,444],[352,442],[352,438],[350,436],[352,435],[352,427],[353,425],[353,421],[355,420],[355,416],[357,414],[357,410],[361,406],[361,403],[363,401],[363,395],[365,393],[365,390],[368,386],[368,384],[370,382],[370,380],[372,378],[372,376],[374,375],[374,373],[378,369],[378,365],[380,363],[380,361],[382,360],[382,358],[383,356],[383,354],[385,352],[385,350],[387,348],[387,346],[389,345],[389,343],[391,341],[391,339],[393,337],[393,335],[395,333],[395,331],[398,328],[398,326],[400,324],[400,322],[402,320],[402,318],[415,305],[421,305],[423,303],[427,303],[430,307],[430,309],[432,309],[440,316],[441,316],[443,318],[449,318],[451,320],[458,320],[460,322],[464,322],[466,324],[483,324],[486,328],[490,328],[492,330],[496,330],[500,333],[500,341],[501,343],[501,346],[503,346],[505,348],[507,348],[509,350],[511,350],[515,354],[516,354],[518,356],[520,356],[522,358],[524,358],[526,360],[528,360],[531,363],[535,363],[537,365],[539,365],[543,369],[544,369],[546,371],[548,371],[558,380],[559,380],[569,390],[569,391],[571,393],[571,395],[576,401],[576,403],[580,406],[582,405],[586,405],[588,406],[591,406],[593,408],[595,408],[597,410],[599,410],[601,412],[603,412],[606,408],[606,406],[610,403],[610,401],[612,399],[612,384],[610,382],[610,380],[595,365],[593,365],[591,363],[588,363],[586,361],[582,361],[580,360],[578,360],[576,358],[574,358],[573,356],[571,356],[569,354],[565,354],[563,352],[561,352],[559,350],[558,350],[556,348],[554,348],[552,346],[550,346],[548,345],[544,345],[541,341],[539,341],[537,339],[535,339],[533,337],[530,337],[526,333],[524,333],[522,331],[518,331],[516,330],[515,330],[513,328],[511,328],[507,324],[503,324],[501,322],[500,322],[496,318],[494,318],[492,316],[488,316],[486,315],[485,315],[483,313],[481,313],[479,311],[477,311],[475,309],[473,309],[471,307],[470,307],[466,303],[462,303],[460,301],[456,301],[455,300],[451,300],[447,296],[440,296],[438,294]]
        //   ]
        // },
        {
          file_name:"P04_101_27_2237.jpg",
          label: 'box', correct: true,
          polygons:[[[595,406],[593,408],[591,408],[589,410],[586,410],[584,412],[582,412],[580,414],[578,414],[574,418],[573,418],[571,420],[569,420],[567,421],[565,421],[559,427],[558,427],[556,429],[554,429],[552,431],[550,431],[541,440],[539,440],[535,444],[535,446],[533,448],[533,453],[535,455],[535,459],[537,461],[537,465],[539,466],[539,468],[541,470],[541,472],[544,476],[544,478],[554,478],[554,476],[552,474],[552,470],[548,466],[548,461],[546,459],[546,450],[548,448],[548,444],[550,442],[552,442],[554,440],[556,440],[558,438],[559,438],[569,429],[573,429],[576,425],[578,425],[580,423],[582,423],[586,420],[588,420],[593,414],[595,414],[597,412],[599,412],[601,414],[603,414],[604,416],[604,418],[606,420],[606,421],[608,423],[608,425],[612,429],[612,431],[614,433],[614,436],[619,442],[619,444],[621,446],[621,450],[623,451],[623,453],[625,455],[625,463],[621,466],[621,468],[619,470],[618,470],[612,476],[610,476],[610,478],[625,478],[633,470],[634,470],[636,468],[636,451],[634,450],[634,448],[629,442],[629,438],[625,435],[625,433],[623,431],[623,429],[621,427],[621,425],[619,423],[619,421],[616,418],[616,416],[606,406]]]
        },
        {
          file_name:"P35_108_61_8150.jpg",
          label: 'chair', correct: true,
          "polygons":[[[391,120],[389,121],[385,121],[383,123],[382,123],[380,125],[378,125],[376,127],[372,127],[370,129],[368,129],[365,133],[363,133],[361,135],[359,135],[357,136],[355,136],[350,142],[348,142],[344,146],[342,146],[337,151],[335,151],[329,157],[327,157],[320,165],[318,165],[314,168],[314,170],[312,172],[310,172],[301,181],[299,181],[299,183],[294,189],[294,191],[290,195],[290,196],[286,200],[286,204],[284,206],[284,210],[282,211],[282,238],[284,240],[284,245],[286,247],[286,251],[290,255],[290,256],[292,258],[292,260],[294,262],[294,266],[295,268],[295,270],[297,271],[297,273],[299,275],[299,277],[301,279],[301,281],[303,283],[303,285],[305,286],[305,288],[307,290],[307,294],[309,296],[309,298],[312,301],[312,305],[314,307],[314,309],[316,311],[316,315],[320,318],[320,320],[322,322],[322,324],[323,326],[323,328],[327,331],[329,331],[331,333],[333,333],[335,331],[337,331],[342,326],[344,326],[365,305],[367,305],[368,303],[372,303],[378,309],[378,305],[387,296],[389,296],[391,294],[391,286],[393,285],[393,277],[397,273],[397,271],[412,256],[413,256],[413,255],[417,251],[419,251],[428,241],[430,241],[430,240],[434,236],[436,236],[443,228],[445,228],[445,226],[455,217],[455,215],[456,213],[458,213],[458,211],[460,210],[460,206],[462,204],[462,187],[460,185],[460,181],[458,180],[458,178],[456,176],[456,174],[455,172],[455,170],[453,168],[453,166],[449,163],[449,161],[447,159],[447,157],[443,153],[443,151],[440,148],[440,146],[432,138],[432,136],[421,125],[419,125],[415,121],[412,121],[410,120]]]
        },
        {
          file_name:"P04_118_27_2646.jpg",
          label: 'book', correct: false,
          polygons:[[[382,406],[380,408],[378,408],[374,412],[374,420],[376,421],[376,423],[378,425],[378,427],[382,423],[383,423],[385,421],[385,412],[383,410],[383,406]],[[423,397],[423,399],[417,405],[417,406],[415,408],[419,412],[419,416],[417,418],[417,429],[415,431],[406,431],[400,436],[402,436],[404,438],[417,438],[423,433],[423,427],[425,425],[425,423],[428,420],[428,414],[430,412],[430,403],[428,401],[428,399],[427,397]],[[417,384],[417,386],[419,388],[419,384]],[[434,348],[432,350],[432,358],[434,360],[434,371],[436,373],[436,369],[438,367],[438,348]],[[398,343],[398,345],[397,346],[397,352],[395,354],[395,356],[397,356],[398,358],[400,356],[402,356],[402,352],[404,350],[404,346],[400,343]],[[421,341],[421,345],[419,346],[419,352],[417,354],[415,354],[415,356],[417,358],[417,363],[419,365],[419,367],[421,369],[425,369],[425,361],[423,360],[423,352],[425,350],[425,346],[427,345],[427,343],[428,341]]]
        },
        // {
        //   file_name:"P02_108_77_8506.jpg",
        //   polygons:[[[191,309],[189,311],[187,311],[183,315],[181,315],[177,318],[176,318],[159,335],[159,337],[155,341],[155,343],[153,345],[153,346],[151,348],[151,352],[149,354],[149,360],[147,361],[147,376],[149,378],[149,386],[151,388],[151,390],[161,399],[162,399],[164,401],[181,401],[187,395],[189,395],[191,393],[192,393],[204,382],[204,380],[206,378],[206,376],[209,373],[209,371],[211,369],[211,367],[213,365],[213,363],[215,361],[215,354],[217,352],[217,339],[219,337],[219,320],[217,318],[217,316],[209,309]]]
        // },
      ],
    },
    {
      title: 'Only some of the objects',
      description: 'Not all instances of an object need to be segmented for it to be correct.',
      images: [
        {
          file_name:"P30_05_539_147127.jpg",
          label: 'carrot', correct: true,
          polygons:[[[194,333],[191,337],[189,337],[187,339],[187,343],[189,345],[191,345],[192,346],[194,346],[196,348],[200,348],[202,350],[207,350],[209,352],[213,352],[215,354],[220,354],[222,356],[226,356],[230,360],[234,360],[235,361],[239,361],[241,363],[245,363],[247,365],[256,365],[258,367],[267,367],[269,365],[273,365],[275,363],[275,350],[273,348],[269,348],[267,346],[262,346],[260,345],[256,345],[254,343],[249,343],[247,341],[241,341],[239,339],[234,339],[232,337],[217,337],[215,335],[202,335],[200,333]],[[222,243],[220,245],[215,245],[213,247],[209,247],[207,249],[202,249],[200,251],[196,251],[194,253],[192,253],[191,255],[181,255],[179,256],[176,256],[174,258],[166,258],[164,260],[159,260],[157,262],[151,262],[149,264],[147,264],[144,268],[142,268],[142,270],[138,273],[138,279],[140,281],[140,283],[142,285],[149,285],[151,286],[153,285],[159,285],[161,283],[162,283],[164,281],[170,281],[172,279],[174,279],[176,277],[181,277],[183,275],[185,275],[187,273],[192,273],[194,271],[196,271],[198,270],[202,270],[206,266],[209,266],[211,264],[213,264],[215,262],[217,262],[219,260],[222,260],[224,258],[250,258],[254,255],[256,255],[256,247],[254,245],[252,245],[250,243]],[[282,234],[277,240],[275,240],[264,251],[262,251],[262,255],[258,258],[256,258],[250,264],[247,264],[245,262],[235,262],[234,264],[232,264],[230,266],[226,266],[222,270],[219,270],[217,271],[213,271],[211,273],[209,273],[207,275],[206,275],[204,277],[202,277],[200,279],[198,279],[194,283],[194,285],[192,286],[191,286],[189,288],[187,288],[179,296],[177,296],[166,307],[166,311],[164,313],[164,316],[166,316],[168,318],[168,320],[174,320],[176,318],[179,318],[183,315],[185,315],[187,313],[189,315],[189,316],[191,318],[206,318],[207,320],[219,320],[220,322],[224,322],[226,324],[228,324],[230,326],[234,326],[239,331],[241,331],[243,333],[245,333],[247,335],[250,335],[252,337],[258,337],[260,339],[265,339],[267,341],[277,341],[279,339],[280,339],[282,337],[282,333],[284,331],[284,330],[286,328],[286,324],[280,318],[275,318],[273,316],[267,316],[265,315],[260,315],[256,311],[250,311],[249,309],[239,309],[237,307],[232,307],[230,305],[224,305],[222,303],[204,303],[202,301],[206,298],[206,296],[207,294],[209,294],[215,288],[217,288],[219,286],[222,286],[224,285],[226,285],[228,286],[228,288],[226,290],[226,300],[228,301],[237,301],[239,300],[241,300],[262,279],[264,279],[265,277],[267,277],[279,266],[280,266],[286,260],[288,260],[290,258],[290,256],[292,255],[294,255],[295,253],[295,251],[297,249],[297,240],[292,234]],[[166,204],[164,206],[159,206],[155,210],[155,211],[151,215],[151,221],[155,225],[157,225],[159,226],[219,226],[220,225],[226,225],[228,223],[235,223],[237,221],[264,221],[267,217],[267,213],[265,211],[260,211],[258,210],[245,210],[243,208],[237,208],[235,210],[196,210],[194,208],[189,208],[187,206],[174,206],[172,204]]]
        },
        {
          file_name:"P03_109_327_48513.jpg",
          label: 'bread', correct: true,
          polygons:[[[436,350],[432,354],[430,354],[425,360],[423,360],[419,363],[417,363],[413,367],[412,367],[404,375],[402,375],[395,382],[395,384],[391,388],[387,388],[385,390],[380,390],[378,391],[374,391],[372,393],[370,393],[368,395],[367,395],[363,399],[363,401],[361,403],[361,405],[359,406],[359,414],[361,416],[361,418],[363,418],[365,420],[365,421],[370,427],[372,427],[376,423],[380,423],[382,425],[382,427],[385,431],[385,435],[383,436],[383,455],[382,457],[382,465],[385,468],[387,468],[391,472],[397,472],[398,474],[404,474],[406,476],[406,478],[410,478],[410,476],[412,474],[419,474],[421,472],[430,472],[432,470],[436,470],[438,468],[440,468],[443,465],[445,465],[447,463],[447,461],[451,457],[453,457],[456,453],[456,451],[462,446],[462,440],[464,438],[464,436],[462,435],[462,429],[464,427],[464,418],[466,416],[466,406],[468,405],[468,390],[470,388],[468,386],[468,382],[466,380],[466,378],[464,376],[464,375],[462,373],[462,371],[456,365],[456,363],[455,361],[455,358],[449,352],[447,352],[445,350]]]
        },
        {
          file_name:"P28_09_53_12527.jpg",
          label: 'avocado', correct: true,
          polygons:[[[481,361],[479,363],[479,371],[477,373],[477,376],[485,384],[485,399],[488,399],[494,405],[494,414],[496,416],[496,420],[498,420],[500,418],[505,418],[505,412],[503,410],[503,406],[501,405],[501,399],[509,391],[513,391],[515,393],[516,393],[518,395],[522,395],[526,399],[531,399],[531,397],[533,395],[533,393],[531,391],[531,390],[530,388],[530,386],[526,382],[524,382],[518,376],[515,376],[513,375],[511,375],[509,373],[507,373],[503,369],[503,367],[501,367],[498,363],[492,363],[490,365],[488,363],[486,363],[485,361]]]
        }
      ],
    },
    {
      title: 'Objects in various forms',
      description: 'Sometimes as part of the cooking process, objects may present in different forms. For example, the dry ingredients of a biscuit, sliced aubergine (eggplant), and jarred chili.',
      images: [
        {
          file_name:"P02_130_104_11956.jpg",
          label: 'biscuit', correct: true,
          polygons:[[[427,123],[427,127],[419,135],[417,135],[415,136],[410,136],[408,138],[402,138],[400,140],[398,140],[397,142],[395,142],[393,144],[391,144],[389,146],[387,146],[383,150],[380,150],[378,151],[376,151],[374,153],[372,153],[368,157],[367,157],[361,163],[359,163],[355,166],[353,166],[350,170],[350,178],[348,180],[348,183],[350,185],[350,187],[348,189],[348,191],[346,193],[344,191],[342,191],[340,189],[337,189],[335,187],[325,187],[323,185],[307,185],[305,187],[295,187],[294,189],[290,189],[288,191],[284,191],[279,196],[277,196],[275,198],[273,198],[271,200],[271,202],[267,206],[267,213],[269,215],[269,217],[271,219],[271,221],[273,223],[273,226],[271,228],[271,232],[273,234],[275,234],[277,236],[277,238],[282,243],[282,245],[284,247],[284,262],[280,266],[280,268],[279,270],[277,270],[275,271],[273,271],[271,273],[267,273],[265,275],[256,275],[256,277],[258,279],[258,281],[260,283],[260,288],[265,294],[265,298],[271,303],[273,303],[275,305],[275,307],[277,309],[280,309],[284,313],[286,313],[288,315],[295,315],[297,316],[301,316],[303,318],[305,318],[307,320],[309,320],[310,322],[314,322],[316,320],[329,320],[331,318],[338,318],[340,316],[342,316],[353,305],[355,305],[359,301],[359,298],[361,296],[361,294],[365,290],[365,288],[367,286],[372,286],[376,290],[378,290],[380,292],[385,292],[387,294],[389,294],[391,296],[404,296],[406,298],[413,298],[415,300],[430,300],[434,296],[434,294],[436,292],[436,290],[438,288],[438,286],[440,285],[440,283],[441,281],[441,273],[440,271],[440,270],[438,268],[438,260],[436,258],[436,253],[434,251],[434,236],[436,234],[436,226],[421,226],[417,223],[417,221],[413,217],[413,211],[412,210],[412,206],[413,204],[413,200],[415,198],[415,196],[417,195],[417,193],[419,191],[421,191],[423,189],[425,189],[427,191],[436,191],[438,189],[447,189],[447,183],[445,181],[445,172],[443,170],[443,161],[441,159],[441,155],[440,153],[440,151],[438,150],[438,146],[436,144],[436,140],[434,138],[434,135],[432,133],[432,129],[430,127],[430,125],[428,123]],[[325,198],[327,196],[348,196],[350,198],[350,202],[353,206],[353,211],[355,213],[353,215],[350,215],[350,217],[353,221],[353,225],[350,228],[340,228],[338,226],[335,226],[333,225],[327,225],[325,223],[322,223],[320,221],[318,221],[316,219],[314,219],[310,223],[309,223],[305,226],[305,234],[303,236],[305,238],[305,249],[307,251],[307,253],[312,258],[312,260],[314,262],[316,262],[318,264],[320,264],[322,266],[322,268],[323,270],[325,270],[327,271],[335,271],[337,270],[340,270],[348,262],[348,260],[352,256],[353,256],[357,260],[357,262],[359,264],[359,268],[355,271],[353,271],[346,279],[340,279],[338,281],[320,281],[318,279],[316,279],[314,277],[310,277],[307,273],[305,273],[303,271],[301,271],[292,262],[292,245],[295,241],[295,234],[297,232],[297,226],[301,223],[301,219],[305,215],[305,213],[318,200],[320,200],[322,198]],[[262,230],[256,236],[256,238],[250,243],[249,243],[249,255],[250,256],[250,268],[252,270],[252,273],[254,275],[258,275],[260,273],[269,273],[271,271],[275,271],[277,270],[279,270],[280,268],[280,266],[282,264],[282,262],[284,260],[284,249],[282,247],[282,245],[280,243],[280,241],[277,238],[277,236],[275,234],[273,234],[271,232],[271,230]]]

        },
        {
          file_name:"P01_09_456_116673.jpg",
          label: 'aubergine', correct: true,
          polygons:[[[531,75],[528,78],[526,78],[526,80],[522,84],[522,86],[520,88],[515,82],[513,82],[511,80],[507,80],[505,82],[492,82],[488,86],[488,88],[486,90],[486,91],[485,93],[485,101],[486,103],[486,105],[490,108],[490,110],[492,112],[486,118],[486,120],[483,123],[483,136],[490,144],[501,144],[503,146],[503,148],[501,150],[501,151],[498,155],[498,159],[496,161],[496,165],[498,166],[498,170],[501,174],[503,174],[509,180],[511,180],[513,181],[526,181],[528,180],[530,180],[533,176],[533,174],[535,172],[535,168],[537,166],[537,157],[535,155],[535,153],[533,151],[533,148],[531,146],[530,146],[528,144],[530,142],[537,142],[539,144],[541,142],[546,142],[548,144],[544,148],[544,150],[541,153],[541,165],[544,168],[544,170],[550,176],[550,178],[552,178],[554,180],[558,180],[559,181],[563,181],[565,180],[569,180],[576,172],[576,168],[578,166],[578,161],[574,157],[574,150],[569,144],[567,144],[565,142],[550,142],[548,140],[554,135],[554,120],[556,118],[556,116],[554,114],[554,110],[548,105],[548,103],[544,99],[548,95],[548,80],[544,76],[541,76],[539,75]],[[546,142],[548,140],[550,142],[548,144]],[[563,67],[561,69],[559,69],[558,71],[558,73],[554,76],[554,93],[556,95],[556,97],[565,106],[578,106],[582,103],[584,103],[591,95],[591,86],[589,84],[589,82],[588,80],[588,78],[584,75],[584,73],[580,69],[578,69],[576,67]]]
        },
        {
          file_name:"P06_09_42_32929.jpg",
          label: 'chili', correct: true,
          polygons:[[[481,234],[479,236],[475,236],[473,238],[471,238],[470,240],[460,240],[458,241],[453,241],[451,243],[447,243],[445,245],[443,245],[441,247],[436,247],[427,256],[427,258],[412,273],[412,277],[410,279],[410,283],[412,285],[412,288],[419,296],[421,296],[423,298],[427,298],[428,300],[430,300],[432,301],[434,301],[436,303],[436,305],[440,309],[441,309],[443,311],[464,311],[466,309],[470,309],[471,307],[477,307],[479,305],[481,305],[483,303],[485,303],[488,300],[490,300],[492,298],[494,298],[496,296],[496,283],[494,281],[494,279],[492,277],[492,266],[490,264],[490,251],[488,249],[488,243],[486,241],[486,240],[485,238],[485,236],[483,234]]]
        },
      ],
    },
    {
      title: 'Difficult to see',
      description: 'The image is really blurry/low-light, but given the context, take your best guess.',
      images: [
        {
          file_name:"P28_06_22_5257.jpg",
          label: 'container', correct: true,
          polygons:[[[456,307],[455,309],[451,309],[449,311],[447,311],[445,313],[441,313],[440,315],[434,315],[432,316],[428,316],[427,318],[425,318],[423,320],[421,320],[419,322],[415,322],[413,324],[412,324],[408,328],[406,328],[404,330],[402,330],[400,331],[398,331],[387,343],[387,345],[382,350],[382,352],[380,354],[380,358],[378,360],[378,361],[376,363],[376,369],[374,371],[374,380],[372,382],[372,386],[374,388],[374,390],[376,390],[382,384],[383,384],[395,373],[398,373],[402,369],[404,369],[406,367],[410,367],[412,365],[415,365],[417,363],[428,363],[430,361],[434,361],[436,360],[445,360],[447,358],[449,358],[456,365],[456,393],[458,395],[458,397],[470,397],[471,395],[473,395],[475,393],[475,391],[477,390],[477,380],[475,378],[475,376],[477,375],[477,367],[475,365],[475,361],[477,360],[477,331],[475,330],[475,326],[473,324],[473,322],[471,320],[471,318],[470,316],[470,315],[466,311],[466,309],[464,307]]]
        },
        {
          file_name:"P12_101_208_29229.jpg",
          label: 'container', correct: true,
          polygons:[[[633,339],[629,343],[627,343],[618,352],[618,354],[616,356],[616,361],[618,363],[618,365],[619,367],[621,367],[625,371],[627,371],[631,375],[634,375],[636,376],[642,376],[644,378],[655,378],[655,373],[653,371],[653,369],[642,358],[640,358],[636,354],[636,352],[638,350],[638,345],[636,343],[636,341],[634,341]]]
        },
        {
          "file_name":"P30_05_386_110972.jpg",
          label: 'can', correct: false,
          "polygons":[[[473,270],[471,271],[470,271],[468,273],[468,283],[466,285],[466,298],[468,300],[468,307],[470,309],[470,326],[471,328],[471,333],[473,335],[473,339],[475,341],[475,346],[477,348],[477,350],[479,352],[479,358],[481,360],[481,367],[483,369],[483,380],[485,382],[485,403],[486,405],[486,416],[488,418],[488,421],[490,423],[490,425],[498,425],[500,423],[501,423],[511,414],[511,412],[513,410],[513,408],[515,406],[515,390],[516,388],[516,380],[518,378],[518,361],[520,360],[520,350],[518,348],[518,333],[516,331],[516,316],[515,315],[515,305],[513,303],[513,300],[511,298],[511,294],[509,292],[509,288],[507,286],[507,283],[505,281],[505,277],[498,270]]]
        }
      ],
    },
    // {
    //   title: 'Spill over',
    //   description: 'The image is really blurry/low-light, but given the context, you can take a guess.',
    //   images: [
    //   ],
    // },
  ]

  return (<Stack spacing={1} direction='row' justifyContent='center' alignItems='center'>
  <PopupExample message={<>
    Instructions
    </>} color='primary'>
      <KeyHints />

      <Sheet sx={{ 
        maxWidth: 850,  textAlign: 'center',
        '& ul': {
          textAlign: 'left',
          pl: 4,
          '& li': {
            my: 2,
          }
        },
        h3: {
          mt: 2,
        }
      }}>
        <Box textAlign='center' sx={{ px: 6 }}>
        <T level='h1' sx={{ my: 4 }}>
          Verify the highlighted object
        </T>
        <Stack direction='row'>
          {HEADER_IMS?.map(({src, file_name, ...p}) => <SegmentedImage src={src||`${baseUrl}/${file_name}`} {...p} />)}
        </Stack>
        <T level='h4' sx={{ fontWeight: 400 }} mb={4} textAlign='center'>
        <T level='h3' sx={{ fontWeight: 900 }}>POV: </T>
        You are cooking, cleaning, etc. in a kitchen. <br/>
        These are screenshots taken from your point of view.
        </T>

        <T level='h3' sx={{ fontWeight: 900 }}>Objective: </T>
        <T level='h4' sx={{ fontWeight: 400 }} mb={2} textAlign='center'>
        Your task is to verify that the highlighted area refers to the object mentioned in the question.
        </T>
        <ul>
          <li>If the highlighted area includes multiple instances of the object, the annotation is valid.</li>
          <li>If the highlighted area includes a significant or meaningful part of the object, the annotation is also valid.</li>
          <li>
            If the highlighted area includes other objects, but the target object is still the dominant part of the annotation, 
            the annotation can be considered valid.
          </li>
        </ul>
        </Box>

        {/* <T sx={{
          '& ul': {
            textAlign: 'left',
            pl: 4,
            '& li': {
              my: 2,
            }
          }
        
        }}>
          <T level='h1' sx={{ my: 4 }} textAlign='center'>
            Guidelines
          </T>
          <ul>
            <li>Perfect outline/segmentation is not required to be valid.</li>
            <li>
              There may be some cases where the vocabulary is slightly off (e.g. "can opener" labeled as "bottle opener").
              This is purely a result of label simplification. In these cases, use your best judgement.
            </li>
            <li>
              We want to know if the annotation is referentially linked to the label, so if multiple of an object is selected, 
              or a meaningful part of an object is selected, those annotations are valid.
            </li>
            <li>
              If the annotation contains other objects in addition to the target object, it can be considered correct 
              as long as the target object still is the majority of the annotation or if the other object is strongly
              related to the target object (e.g. if the noun is "bread" and the annotation contains the plate that the bread is on as well).
            </li>
            <li>If you are unsure, take your best guess based on the visible highlighted area and the available context.</li>
          </ul>
        </T> */}

        <T level='h1' sx={{ my: 4 }} textAlign='center'>
          Examples
        </T>


        {EXAMPLES?.map(({ title, description, images }) => (
          <B>
            <T level='h3'>{title}</T>
            <T>{description}</T>
            <Stack direction='row'>
              {images?.map(({src, file_name, ...p}) => <SegmentedImage src={src||`${baseUrl}/${file_name}`} {...p} />)}
            </Stack>
          </B>
        ))}

        {/* <T>
          <T level="h3">Tips:</T>
          <ul>
            <li>If you are unsure, take your best guess based on the visible highlighted area.</li>
          </ul>
        </T> */}
        <T level='h3'  textAlign='center' my={5} pt={5}>
          Thanks! âœ¨
        </T>
      </Sheet>

    </PopupExample>
  </Stack>)
}


const InstructionsTask2 = ({ baseUrl }) => {
  const EXAMPLES = [
    {
      title: 'Easy Cases',
      description: 'The object is clearly visible and easy to classify.',
      images: [
        {
          "file_name":"P04_02_238_67186.jpg",
          label: 'onion cut', correct: true,
        },
        {
          file_name:"P23_101_108_39108.jpg",
          label: 'onion cut', correct: false,
        },
      ],
    },
  ]

  return (<Stack spacing={1} direction='row' justifyContent='center' alignItems='center'>
  <PopupExample message={<>
    Instructions
    </>} color='primary'>
      <KeyHints />

      <Sheet sx={{ 
        maxWidth: 850,  textAlign: 'center',
        '& ul': {
          textAlign: 'left',
          pl: 4,
          '& li': {
            my: 2,
          }
        },
        h3: {
          mt: 2,
        }
      }}>
        <Box textAlign='center' sx={{ px: 6 }}>
        <T level='h1' sx={{ my: 4 }}>
          Evaluate the statement
        </T>
        <T level='h1' sx={{ my: 4 }}>
          e.g. "Is the onion cut?"
        </T>

        <T level='h4' sx={{ fontWeight: 400 }} mb={4} textAlign='center'>
        <T level='h3' sx={{ fontWeight: 900 }}>POV: </T>
        You are cooking, cleaning, etc. in a kitchen. <br/>
        These are screenshots taken from your point of view.
        </T>

        <T level='h3' sx={{ fontWeight: 900 }}>Objective: </T>
        <T level='h4' sx={{ fontWeight: 400 }} mb={2} textAlign='center'>
        Your task is to verify that the statement is true about a referenced object in the scene. <br/>
        If there are multiple of the same object, the statement only needs to be true about one of them.
        </T>
        </Box>

        <T level='h1' sx={{ my: 4 }} textAlign='center'>
          Examples
        </T>


        {EXAMPLES?.map(({ title, description, images }) => (
          <B>
            <T level='h3'>{title}</T>
            <T>{description}</T>
            <Stack direction='row'>
              {images?.map(({src, file_name, ...p}) => <SegmentedImage src={src||`${baseUrl}/${file_name}`} {...p} />)}
            </Stack>
          </B>
        ))}

        <T level='h3'  textAlign='center' my={5} pt={5}>
          Thanks! âœ¨
        </T>
      </Sheet>

    </PopupExample>
  </Stack>)
}


export function Task1(props) {
  const { noun, group, baseUrl, aliases } = props;
  return <ImageForm {...props} 
                    optionLabels={{ correct: noun, wrong: `not ${noun}` }} 
                    formMeta={{ noun, group }} 
                    help={<>
  </>}>

    <LabelBox button={<InstructionsTask1 baseUrl={baseUrl} />}>

      <Typography textAlign='center' level='h3' sx={{ fontWeight: 400 }}>
        Can this object be described as
        <Typography sx={{ fontSize: '1.8em' }}>
          <Co>[</Co><b>{noun || 'â€”'}</b>({pluralSuffix(noun)})<Co>]</Co>
        </Typography>?
      </Typography>

      {aliases?.length && <Stack direction='row' gap={2} justifyContent='center'>
        <Typography>
          Also accepted:
        </Typography>
        <Stack direction='row' gap={2} justifyContent='center' sx={{overflow: 'auto'}}>
          {aliases.map(x => <Chip variant='soft' color='primary' key={x}>{x}</Chip>)}
        </Stack>
      </Stack>}

    </LabelBox>
  </ImageForm>
}

export function Task2(props) {
  console.log(props)
  const { noun, state, group, baseUrl, aliases } = props;
  const {
    bigQuestion, question, statement, positive, positiveQuestion, negativeQuestion, positiveStatement, negativeStatement, positiveShort, negativeShort
  } = naturalizePredicate(state, noun);

  return <ImageForm {...props} 
                    optionLabels={{ correct: positiveShort, wrong: negativeShort }} 
                    formMeta={{ noun, state, group }} 
                    help={<>
  </>}>
    <LabelBox button={<InstructionsTask2 baseUrl={baseUrl} />}>
      <Typography textAlign='center' level='h3' sx={{ 
          fontWeight: 400,
          display: 'flex',
          justifyContent: 'center',
          alignItems: 'center',
          flexWrap: 'wrap',
        }}>
        {bigQuestion}
        {/* {positiveQuestion} */}
      </Typography>
    </LabelBox>
  </ImageForm>
}

const ES = ['s', 'x', 'z', 'ch', 'sh'];
function pluralSuffix(word) {
  return word ? (ES.includes(word.slice(-1)) ? 'es' : 's') : '';
}


function naturalizePredicate(predicate, subjectNoun, objectNoun) {
  if(!predicate) return {};
  const regex = /(?:\((not ))?\((?:(is|can)-)?([\w-]+)\s+([?\w\s]+)\)+/g;
  const match = regex.exec(predicate);

  let not, linkVerb, shortLinkVerb, adj, object, args, subjectArticle, objectArticle;
  if (match) {
    [, not, linkVerb, adj, args] = match;
    [, object] = args?.split(' ');
  } else {
    adj = predicate.split('?')[0].replace(/[()]/g,'');
  }
  if(object && !objectNoun && !object.startsWith('?')) {
    objectNoun = object;
  }
  
  not = not||'';
  linkVerb = linkVerb||'is';
  shortLinkVerb = linkVerb=='is'?'' : linkVerb;
  adj = adj?.replace('-', ' ');

  if (`${linkVerb} ${adj}` == 'can fit') {
    adj = 'fit in';
  }
  if (adj == 'onsurface') {
    adj = 'on';
    object = 'surface';
    objectNoun = 'surface';
  }

  subjectArticle = "the"
  objectArticle = object && objectNoun?"a":"";
  subjectNoun = subjectNoun || "object";
  objectNoun = object ? (objectNoun||"something") : "";
  // fixes
  
  const cln = q => q.replace(/\s+([\s?])/g, '$1').trim();
  return {
    // is the onion not touching a hand?
    question: cln(`${linkVerb} ${subjectArticle} ${subjectNoun} ${not} ${adj} ${objectArticle} ${objectNoun}?`),
    // onion not touching hand
    statement: cln(`${subjectNoun} ${linkVerb} ${not} ${adj} ${objectNoun}`),
    positive: !not,
    positiveQuestion: cln(`${linkVerb} ${subjectArticle} ${subjectNoun} ${adj} ${objectArticle} ${objectNoun}?`),
    negativeQuestion: cln(`${linkVerb} ${subjectArticle} ${subjectNoun} not ${adj} ${objectArticle} ${objectNoun}?`),
    positiveStatement: cln(`${subjectNoun} ${linkVerb} ${adj} ${objectNoun}`),
    negativeStatement: cln(`${subjectNoun} ${linkVerb} not ${adj} ${objectNoun}`),
    positiveShort: cln(`${subjectNoun} ${shortLinkVerb} ${adj}`),
    negativeShort: cln(`${subjectNoun} ${shortLinkVerb} not ${adj}`),
    positiveVerb: cln(`${shortLinkVerb} ${adj}`),
    negativeVerb: cln(`${shortLinkVerb} not ${adj}`),
    bigQuestion: <>
      {linkVerb} {subjectArticle} <Big v='outlined'>{subjectNoun}</Big> <Big v='soft'>{adj}</Big> {objectArticle} <Big v='outlined'>{objectNoun}</Big>?
    </>
  };
}


export default function Task({ task='noun', ...props }) {
  switch (task) {
    case 'noun':
      return <Task1 {...props} />
    case 'predicate':
      return <Task2 {...props} />
    default:
      return <Typography>Task {task} not found</Typography>
  }
}